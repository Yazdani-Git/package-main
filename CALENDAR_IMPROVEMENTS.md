# بهبودهای سیستم تقویم جایتو (Jaito Calendar Improvements)

## خلاصه تغییرات (Summary of Changes)

این مستند تمامی بهبودهای اعمال شده بر روی سیستم تقویم جایتو برای اجاره ویلا را شرح می‌دهد. تغییرات شامل بهبود منطق انتخاب تاریخ، ظاهر کاربری، و تجربه کاربر می‌باشد.

## ویژگی‌های جدید (New Features)

### 1. منطق انتخاب تاریخ پیشرفته (Enhanced Date Selection Logic)

#### تاریخ ورود (Check-in Date Selection):
- **محدودیت روزهای گذشته**: امکان انتخاب روزهای گذشته وجود ندارد
- **اعتبارسنجی روزهای فعال**: فقط روزهای موجود در کالندر قیمت قابل انتخاب هستند
- **بررسی رزروهای موجود**: روزهای رزرو شده قابل انتخاب نیستند

#### تاریخ خروج (Check-out Date Selection):
- **محدودیت بعد از ورود**: تاریخ خروج حتماً بعد از تاریخ ورود باشد
- **تشخیص روزهای غیرفعال**: اگر بین تاریخ ورود و خروج روز غیرفعال باشد، انتخاب مجاز نیست
- **فعال‌سازی محدود**: فقط تا اولین روز غیرفعال بعد از ورود، روزها قابل انتخاب هستند

### 2. بهبودهای ظاهری (Visual Improvements)

#### طراحی مدرن و زیبا:
- **سایه و گردی**: استفاده از box-shadow و border-radius مدرن
- **انیمیشن‌های نرم**: انیمیشن‌های smooth برای انتخاب تاریخ
- **رنگ‌بندی هوشمند**: رنگ‌های متفاوت برای وضعیت‌های مختلف تاریخ
- **Typography بهتر**: استفاده از فونت Vazir و وزن‌های مناسب

#### وضعیت‌های مختلف تاریخ:
- **روز امروز**: پس‌زمینه آبی روشن
- **روزهای جمعه**: رنگ قرمز
- **روزهای انتخاب شده**: پس‌زمینه آبی و سایه
- **روزهای غیرفعال**: خاکستری با opacity کم
- **روزهای رزرو شده**: پس‌زمینه زرد
- **روزهای نامعتبر**: پس‌زمینه قرمز روشن

### 3. تجربه کاربری بهتر (Improved User Experience)

#### پیام‌های راهنما:
- **خطاهای واضح**: نمایش پیام‌های خطای فارسی و واضح
- **راهنمایی کاربر**: توضیح دلیل عدم امکان انتخاب تاریخ
- **بازخورد فوری**: نمایش وضعیت loading و تأیید انتخاب

#### محاسبه قیمت هوشمند:
- **محاسبه خودکار**: محاسبه فوری قیمت پس از انتخاب بازه
- **نمایش جزئیات**: نمایش قیمت هر شب، تخفیف، و مجموع
- **واحد پولی فارسی**: استفاده از اعداد فارسی و واحد تومان

## تغییرات فایل‌ها (File Changes)

### فایل‌های PHP:
- `plugins/jayto-widget/Calender.php` - کلاس تقویم موبایل
- `plugins/jayto-widget/Calender_desktop.php` - کلاس تقویم دسکتاپ  
- `themes/jayto/calender2.php` - کلاس تقویم checkout
- `themes/jayto/functions.php` - توابع backend

### فایل‌های JavaScript:
- `themes/jayto/js/theme.js` - منطق frontend و تعامل کاربر

### فایل‌های CSS:
- `themes/jayto/css/style.css` - استایل‌های جدید و بهبودها

## متدهای جدید (New Methods)

### کلاس‌های PHP:
```php
// تنظیم تاریخ ورود برای تقویم خروج
public function set_check_in($check_in_date)

// تنظیم لیست تاریخ‌های رزرو شده
public function set_reserved_dates($reserved_dates)

// بررسی در دسترس بودن تاریخ
private function is_date_available($date)

// یافتن اولین تاریخ غیرفعال بعد از ورود
private function get_first_unavailable_after_checkin($check_in_date)

// بررسی وجود تاریخ غیرفعال در بازه
private function has_unavailable_dates_between($start_date, $end_date)
```

### توابع JavaScript:
```javascript
// به‌روزرسانی تقویم خروج بر اساس ورود
function updateCheckoutCalendar(checkinDate, outCalendar)

// محاسبه و نمایش قیمت
function calculatePrice(checkin, checkout, res_id, no_people, elm_d)

// نمایش پیام‌های خطا
function showDateSelectionError(message)
```

## کلاس‌های CSS جدید (New CSS Classes)

### کلاس‌های اصلی:
- `.improved-calendar` - تقویم بهبود یافته
- `.desktop-calendar` - تقویم دسکتاپ
- `.checkout-calendar` - تقویم خروج

### کلاس‌های وضعیت:
- `.today` - روز امروز
- `.friday` - روزهای جمعه
- `.selected` - تاریخ انتخاب شده
- `.unavailable` - تاریخ غیرفعال
- `.reserved` - تاریخ رزرو شده
- `.before-checkin` - قبل از ورود
- `.after-limit` - بعد از محدودیت
- `.invalid-range` - بازه نامعتبر
- `.animate-select` - انیمیشن انتخاب

### کلاس‌های کمکی:
- `.loading` - وضعیت بارگذاری
- `.date-selection-error` - پیام خطا
- `.res_factor_item` - آیتم فاکتور
- `.rft_box` - جعبه مجموع

## قابلیت‌های Responsive

### موبایل (Mobile):
- عرض کامل در صفحات کوچک
- اندازه مناسب برای لمس
- فونت و spacing بهینه شده

### تبلت (Tablet):
- تطبیق خودکار با اندازه صفحه
- حفظ تجربه کاربری مطلوب

### دسکتاپ (Desktop):
- ظاهر کامپکت و زیبا
- نمایش دو تقویم ورود و خروج

## ویژگی‌های دسترسی (Accessibility)

- پشتیبانی از keyboard navigation
- Outline واضح برای focus
- کنتراست رنگ مناسب
- پشتیبانی از screen readers

## پشتیبانی از Dark Mode

تقویم از حالت Dark Mode نیز پشتیبانی می‌کند و به صورت خودکار با تنظیمات سیستم کاربر تطبیق می‌یابد.

## نحوه استفاده (Usage)

### برای توسعه‌دهندگان:

1. کلاس‌های تقویم به صورت خودکار ویژگی‌های جدید را اعمال می‌کنند
2. برای تنظیم تاریخ ورود در تقویم خروج از `set_check_in()` استفاده کنید
3. برای تنظیم تاریخ‌های رزرو شده از `set_reserved_dates()` استفاده کنید

### برای کاربران نهایی:

1. ابتدا تاریخ ورود را انتخاب کنید
2. سپس تاریخ خروج را از روزهای فعال انتخاب کنید
3. قیمت به صورت خودکار محاسبه و نمایش داده می‌شود
4. در صورت خطا، پیام راهنما نمایش داده می‌شود

## مزایای کلیدی (Key Benefits)

1. **تجربه کاربری بهتر**: انتخاب تاریخ آسان‌تر و بدون خطا
2. **ظاهر مدرن**: طراحی زیبا و متناسب با استانداردهای امروزی
3. **عملکرد بهتر**: کاهش خطاهای انتخاب تاریخ نامعتبر
4. **پشتیبانی کامل**: سازگاری با موبایل و دسکتاپ
5. **محاسبه دقیق**: قیمت‌گذاری صحیح و شفاف

---

**توجه**: این بهبودها با کدهای موجود سازگار بوده و نیازی به تغییر اساسی در ساختار پروژه نیست.